<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>äººæœºå¯¹æˆ˜ Â· äº”å­æ£‹</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="../css/base/reset.css">
    <link rel="stylesheet" href="../css/base/typography.css">
    <link rel="stylesheet" href="../css/theme/material-colors.css">
    <link rel="stylesheet" href="../css/theme/animations.css">
    <link rel="stylesheet" href="../css/layout/container.css">
    <link rel="stylesheet" href="../css/components/buttons.css">
    <link rel="stylesheet" href="../css/components/board.css">
    <link rel="stylesheet" href="../css/pages/local-2p.css">
</head>
<body class="md2-theme local-2p-page">
    <div class="container game-page">
        <header class="game-header">
            <a href="../index.html" class="md2-icon-button">
                <span class="material-icons">arrow_back</span>
            </a>
            <h2 class="md2-title">äººæœºå¯¹æˆ˜</h2>
            <div style="display: flex; gap: 8px;">
                <button class="md2-button" id="resetBtn">é‡æ–°å¼€å§‹</button>
                <button class="md2-button" id="downloadLogBtn" style="background-color: #2196f3;">ğŸ“¥ ä¸‹è½½æ—¥å¿—</button>
            </div>
        </header>
        <main class="game-main">
            <div class="board-wrapper">
                <canvas id="board" width="600" height="600" class="board-canvas"></canvas>
            </div>
            <div class="turn-indicator" id="turnIndicator">
                <span class="material-icons">circle</span> ä½ çš„å›åˆ
            </div>
        </main>
        <footer class="game-footer">
            <span class="md2-caption">ä½ æ‰§é»‘å…ˆæ‰‹ Â· AIé˜²å®ˆå‹</span>
        </footer>
    </div>

    <!-- æ—¥å¿—æ•è·è„šæœ¬ï¼ˆå¿…é¡»æœ€å…ˆæ‰§è¡Œï¼‰ -->
    <script>
        (function() {
            // ä¿å­˜åŸå§‹ console.log
            const originalLog = console.log;
            // åˆ›å»ºæ—¥å¿—æ•°ç»„ï¼Œé™åˆ¶æœ€å¤§æ¡æ•°é¿å…å†…å­˜æº¢å‡º
            window._aiLogs = [];
            const MAX_LOGS = 2000;

            // é‡å†™ console.log
            console.log = function(...args) {
                // è°ƒç”¨åŸå§‹æ–¹æ³•ï¼Œç¡®ä¿æ§åˆ¶å°æ­£å¸¸è¾“å‡º
                originalLog.apply(console, args);

                // å°†å‚æ•°æ‹¼æ¥æˆå­—ç¬¦ä¸²
                const message = args.map(arg => {
                    if (typeof arg === 'object') {
                        try {
                            return JSON.stringify(arg, null, 2);
                        } catch (e) {
                            return String(arg);
                        }
                    }
                    return String(arg);
                }).join(' ');

                // æ·»åŠ æ—¶é—´æˆ³
                const timestamp = new Date().toLocaleTimeString('zh-CN', { hour12: false });
                const logEntry = `[${timestamp}] ${message}`;

                // å­˜å…¥æ•°ç»„
                window._aiLogs.push(logEntry);
                if (window._aiLogs.length > MAX_LOGS) {
                    window._aiLogs.shift();
                }
            };

            // ä¹Ÿå¯æ•è·é”™è¯¯
            window.addEventListener('error', (e) => {
                console.log(`[é”™è¯¯] ${e.message}`);
            });
        })();
    </script>

    <!-- åŠ è½½é…ç½® -->
    <script src="../js/config.js"></script>

    <!-- æ¨¡å—è„šæœ¬ -->
    <script type="module">
        import AIGame from '../js/ai/ai-game.js';

        const canvas = document.getElementById('board');
        const turnIndicator = document.getElementById('turnIndicator');
        const resetBtn = document.getElementById('resetBtn');
        const downloadLogBtn = document.getElementById('downloadLogBtn');

        // åˆå§‹åŒ–æ¸¸æˆ
        const game = new AIGame(canvas, turnIndicator, resetBtn, 1);

        // ä¸‹è½½æ—¥å¿—åŠŸèƒ½
        downloadLogBtn.addEventListener('click', () => {
            const logs = window._aiLogs || [];
            if (logs.length === 0) {
                alert('æš‚æ— æ—¥å¿—å¯ä¸‹è½½');
                return;
            }

            const content = logs.join('\n');
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `gomoku_ai_log_${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.log`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
    </script>
</body>
</html>